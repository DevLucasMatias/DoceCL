<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Brigadeiros Gourmet - Painel de Controle</title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal.active {
            display: flex;
        }
        .status-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-toggle input[type="checkbox"] {
            display: none;
        }
        .status-toggle .toggle-slider {
            position: relative;
            width: 40px;
            height: 20px;
            background-color: #ccc;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .status-toggle .toggle-slider.paid {
            background-color: #28a745;
        }
        .status-toggle .toggle-slider.unpaid {
            background-color: #dc3545;
        }
        .status-toggle .toggle-slider::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        .status-toggle input[type="checkbox"]:checked + .toggle-slider::after {
            transform: translateX(20px);
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 font-sans">
    <header class="bg-cover bg-center text-white py-12 text-center relative" style="background-image: url(doce.jpg)">
        <div class="absolute inset-0 bg-black opacity-50"></div>
        <div class="relative z-10">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Brigadeiros Gourmet</h1>
            <p class="text-lg md:text-xl">Lucas & Cleice</p>
        </div>
    </header>

    <div class="flex min-h-screen">
        <aside class="w-64 bg-gray-800 text-white p-6 flex flex-col">
            <div class="text-2xl font-semibold mb-8 text-center">
                Menu
            </div>
            <nav class="space-y-2" role="tablist">
                <button class="tab active w-full text-left py-3 px-4 rounded-lg bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-pink-500" data-tab="new-sale" role="tab" aria-selected="true" aria-controls="new-sale">
                    Nova Venda
                </button>
                <button class="tab w-full text-left py-3 px-4 rounded-lg bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-pink-500" data-tab="sales-history" role="tab" aria-selected="false" aria-controls="sales-history">
                    Histórico
                </button>
                <button class="tab w-full text-left py-3 px-4 rounded-lg bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-pink-500" data-tab="expenses" role="tab" aria-selected="false" aria-controls="expenses">
                    Despesas
                </button>
            </nav>
        </aside>

        <main class="flex-1 p-6 bg-white">
            <section id="new-sale" class="tab-content active" role="tabpanel" aria-hidden="false">
                <h2 class="text-2xl font-semibold mb-4">Nova Venda</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6" id="produtos"></div>
                <div class="bg-gray-50 p-4 rounded-lg shadow mb-6" id="venda-atual"></div>
                <form id="form-venda" class="bg-gray-50 p-6 rounded-lg shadow">
                    <h3 class="text-xl font-semibold mb-4">Dados do Cliente</h3>
                    <input type="text" id="nome" placeholder="Nome" class="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Nome do cliente" aria-required="true" required />
                    <input type="tel" id="telefone" placeholder="Telefone" class="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Telefone do cliente" />
                    <!-- DATA FIXA NO DIA ATUAL -->
                    <input type="date" id="data" value="" class="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Data da venda" aria-required="true" required />
                    <button type="submit" class="bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500">
                        Registrar Venda
                    </button>
                </form>
            </section>

            <!-- RESUMO FINANCEIRO -->
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-4 mb-6" id="expense-summary">
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-sm">Total de Vendas</p>
                    <p id="sum-vendas" class="text-2xl font-bold">R$ 0,00</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-sm">Recebido (Pagas)</p>
                    <p id="sum-recebido" class="text-2xl font-bold">R$ 0,00</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-sm">Em Aberto</p>
                    <p id="sum-aberto" class="text-2xl font-bold">R$ 0,00</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-500 text-sm">Total de Despesas</p>
                    <p id="sum-despesas" class="text-2xl font-bold">R$ 0,00</p>
                </div>
            </div>

            <section id="sales-history" class="tab-content hidden" role="tabpanel" aria-hidden="true">
                <h2 class="text-2xl font-semibold mb-2">Histórico de Vendas</h2>
                <div class="flex flex-wrap gap-4 mb-6">
                    <input type="text" id="filtro-cliente" placeholder="Cliente" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Filtrar por cliente" />
                    <input type="date" id="filtro-data-inicio" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Data inicial" />
                    <input type="date" id="filtro-data-fim" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Data final" />
                    <select id="filtro-status" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Filtrar por status">
                        <option value="">Todos os Status</option>
                        <option value="pago">Pago</option>
                        <option value="nao-pago">Não Pago</option>
                    </select>
                    <input type="text" id="filtro-produto" placeholder="Produto" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Filtrar por produto" />
                    <button id="export-data" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Exportar
                    </button>
                    <input type="file" id="import-data" accept=".json,.xlsx" class="hidden" aria-label="Importar dados de vendas" />
                    <button id="import-data-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Importar
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <div class="sales-table" id="compradores"></div>
                    <div class="flex justify-between mt-4">
                        <button id="prev-page" class="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 disabled:opacity-50" disabled> Anterior </button>
                        <span id="page-info" class="text-lg">Página 1</span>
                        <button id="next-page" class="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700"> Próximo </button>
                    </div>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-semibold mb-4">Dívidas por Cliente</h3>
                    <div class="flex flex-wrap gap-4 mb-6">
                        <input type="text" id="filtro-cliente-debts" placeholder="Cliente" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Filtrar dívidas por cliente" />
                        <select id="filtro-status-debts" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Filtrar dívidas por status">
                            <option value="">Todos os Status</option>
                            <option value="nao-pago">Não Pago</option>
                        </select>
                    </div>
                    <div class="sales-table" id="client-debts"></div>
                </div>
            </section>

            <section id="expenses" class="tab-content hidden" role="tabpanel" aria-hidden="true">
                <h2 class="text-2xl font-semibold mb-4">Despesas</h2>
                <form id="form-despesa" class="bg-gray-50 p-6 rounded-lg shadow mb-6">
                    <h3 class="text-xl font-semibold mb-4">Registrar Despesa</h3>
                    <select id="categoria-despesa" class="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Categoria da despesa" aria-required="true" required>
                        <option value="">Selecione a Categoria</option>
                        <option value="Uber">Uber</option>
                        <option value="Materiais">Materiais</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <input type="text" id="descricao-despesa" placeholder="Descrição" class="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Descrição da despesa" aria-required="true" required />
                    <input type="number" id="valor-despesa" placeholder="Valor (R$)" step="0.01" min="0" class="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Valor da despesa" aria-required="true" required />
                    <input type="date" id="data-despesa" class="w-full p-2 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Data da despesa" aria-required="true" required />
                    <button type="submit" class="bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500">
                        Registrar Despesa
                    </button>
                </form>
                <div class="flex flex-wrap gap-4 mb-6">
                    <input type="text" id="filtro-despesa-categoria" placeholder="Categoria" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Filtrar por categoria de despesa" />
                    <input type="date" id="filtro-despesa-data-inicio" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Data inicial da despesa" />
                    <input type="date" id="filtro-despesa-data-fim" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Data final da despesa" />
                    <input type="text" id="filtro-despesa-descricao" placeholder="Descrição" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" aria-label="Filtrar por descrição da despesa" />
                    <button id="export-expenses" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Exportar
                    </button>
                    <input type="file" id="import-expenses" accept=".json,.xlsx" class="hidden" aria-label="Importar dados de despesas" />
                    <button id="import-expenses-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Importar
                    </button>
                </div>
                <canvas id="expense-chart" class="max-h-96 mb-6"></canvas>
                <div class="overflow-x-auto">
                    <div class="sales-table" id="despesas"></div>
                    <div class="flex justify-between mt-4">
                        <button id="prev-expense-page" class="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 disabled:opacity-50" disabled> Anterior </button>
                        <span id="expense-page-info" class="text-lg">Página 1</span>
                        <button id="next-expense-page" class="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700"> Próximo </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODAL DE CONFIRMAÇÃO DE VENDA -->
    <div id="modal-confirmacao" class="modal" role="dialog" aria-labelledby="modal-venda-title">
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
            <h3 id="modal-venda-title" class="text-xl font-semibold mb-4">Confirmação de Venda</h3>
            <div id="modal-venda-detalhes" class="mb-4"></div>
            <div class="flex justify-end gap-4">
                <button id="confirmar-venda" class="bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500">
                    Confirmar
                </button>
                <!-- BOTÃO NOVA VENDA APÓS CONFIRMAÇÃO -->
                <button id="nova-venda-apos-confirmar" class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 hidden">
                    Nova Venda
                </button>
                <button id="cancelar-venda" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="modal-confirmacao-despesa" class="modal" role="dialog" aria-labelledby="modal-despesa-title">
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
            <h3 id="modal-despesa-title" class="text-xl font-semibold mb-4">Confirmação de Despesa</h3>
            <div id="modal-despesa-detalhes" class="mb-4"></div>
            <div class="flex justify-end gap-4">
                <button id="confirmar-despesa" class="bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500">
                    Confirmar
                </button>
                <button id="cancelar-despesa" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>